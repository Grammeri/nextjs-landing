#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# ----------------------------------------
# Block commits that modify config files
# ----------------------------------------

PROTECTED_PATHS="
.editorconfig
.gitattributes
.prettierrc
.prettierignore
.eslint*
next.config.ts
tsconfig.json
pnpm-workspace.yaml
.github/workflows/
.husky/
"

STAGED_FILES=$(git diff --cached --name-only)

for file in $STAGED_FILES; do
  for protected in $PROTECTED_PATHS; do
    case "$file" in
      $protected* )
        echo ""
        echo "‚ùå Commit blocked."
        echo ""
        echo "Protected configuration file modified:"
        echo "  - $file"
        echo ""
        echo "Configuration files are protected."
        echo "If this change is intentional, run:"
        echo ""
        echo "  ALLOW_CONFIG_CHANGES=true git commit ..."
        echo ""
        exit 1
        ;;
    esac
  done
done

# ----------------------------------------
# Run lint-staged normally
# ----------------------------------------

pnpm lint-staged